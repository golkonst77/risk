#!/bin/sh
# Git hook: добавление версии к сообщению коммита

COMMIT_MSG_FILE=$1
VERSION_FILE="public/version.json"

# Проверяем существование файла version.json
if [ ! -f "$VERSION_FILE" ]; then
  echo "⚠️  Файл version.json не найден"
  exit 0
fi

# Читаем версию из JSON файла
VERSION=$(node -p "try { require('./public/version.json').version } catch(e) { '0.0.0' }")

# Читаем текущее сообщение коммита
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Проверяем, не начинается ли уже сообщение с версии
if echo "$COMMIT_MSG" | grep -q "^\[v[0-9]"; then
  # Версия уже добавлена, ничего не делаем
  exit 0
fi

# Добавляем версию к сообщению
echo "[v$VERSION] $COMMIT_MSG" > "$COMMIT_MSG_FILE"

exit 0
