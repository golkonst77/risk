# Установка и настройка парсера АУСН

## Содержание
1. [Требования](#требования)
2. [Установка на Linux](#установка-на-linux)
3. [Установка на Windows](#установка-на-windows)
4. [Настройка расписания](#настройка-расписания)
5. [Обновление данных в проекте](#обновление-данных-в-проекте)
6. [Мониторинг и логи](#мониторинг-и-логи)
7. [Устранение неполадок](#устранение-неполадок)

## Требования

- Node.js 16+
- npm 8+
- Доступ к интернету для загрузки данных

## Установка на Linux

### 1. Клонирование репозитория

```bash
# Переходим в домашнюю директорию
cd ~

# Клонируем репозиторий (если еще не склонирован)
git clone https://github.com/golkonst77/AUSN.git

# Переходим в директорию с парсером
cd AUSN/ausn-parser
```

### 2. Установка зависимостей

```bash
# Устанавливаем зависимости
npm install

# Устанавливаем PM2 глобально
sudo npm install -g pm2
```

### 3. Настройка окружения

```bash
# Копируем пример конфигурации
cp env.example .env

# Редактируем настройки (при необходимости)
nano .env
```

### 4. Запуск парсера

```bash
# Запускаем парсер
pm2 start src/index.js --name "ausn-parser"

# Добавляем в автозагрузку
pm2 startup
# Выполняем команду, которую выдаст предыдущая команда
# Пример: sudo env PATH=$PATH:/usr/bin /usr/lib/node_modules/pm2/bin/pm2 startup systemd -u username

# Сохраняем список процессов
pm2 save
```

## Установка на Windows

### 1. Установка Node.js

1. Скачайте и установите Node.js с [официального сайта](https://nodejs.org/)
2. При установке отметьте опцию "Add to PATH"

### 2. Настройка парсера

```cmd
# Клонируем репозиторий (если еще не склонирован)
git clone https://github.com/golkonst77/AUSN.git

# Переходим в директорию с парсером
cd AUSN\ausn-parser

# Устанавливаем зависимости
npm install

# Устанавливаем PM2 глобально
npm install -g pm2

# Копируем пример конфигурации
copy env.example .env
```

### 3. Автозапуск на Windows

1. Создайте файл `start-parser.bat`:
   ```batch
   @echo off
   cd /d D:\path\to\AUSN\ausn-parser
   pm2 start src/index.js --name "ausn-parser"
   ```

2. Добавьте ярлык на этот файл в папку автозагрузки:
   - Нажмите `Win + R`
   - Введите `shell:startup`
   - Создайте ярлык для `start-parser.bat`

## Настройка расписания

Парсер по умолчанию настроен на обновление данных по понедельникам и пятницам в 07:00. Чтобы изменить расписание:

1. Откройте файл `.env`
2. Измените значение `CRON_SCHEDULE`
   - Пример: `0 7 * * 1,5` (понедельник и пятница в 07:00)
   - Формат: `минута час день_месяца месяц день_недели`

## Обновление данных в проекте

После успешного парсинга обновите данные в основном проекте:

```bash
cd /path/to/AUSN
npm run update-data
```

## Мониторинг и логи

### Основные команды PM2

```bash
# Просмотр статуса
pm2 status

# Просмотр логов
pm2 logs ausn-parser

# Мониторинг в реальном времени
pm2 monit

# Перезапуск парсера
pm2 restart ausn-parser
```

### Логи

Логи сохраняются в:
- Linux: `~/.pm2/logs/`
- Windows: `%USERPROFILE%\.pm2\logs\`

## Устранение неполадок

### Парсер не запускается
1. Проверьте установку Node.js: `node -v`
2. Установите зависимости: `npm install`
3. Проверьте логи: `pm2 logs ausn-parser`

### Нет доступа к сайту
1. Проверьте интернет-соединение
2. Убедитесь, что URL в `.env` актуальны
3. Проверьте настройки прокси (если используется)

### Ошибки при парсинге
1. Проверьте селекторы в `src/config.js`
2. Убедитесь, что структура страницы не изменилась
3. Проверьте логи парсера

## Лицензия

[MIT License](LICENSE)
