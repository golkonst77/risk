# Настройка reCAPTCHA

## Обзор

В проекте добавлена защита от ботов с помощью Google reCAPTCHA v2. Капча интегрирована в формы регистрации.

## Компоненты

### 1. ReCAPTCHAComponent (`components/recaptcha.tsx`)
- React компонент для отображения капчи
- Автоматически сбрасывается при монтировании
- Показывает заглушку, если ключи не настроены

### 2. API Endpoint (`app/api/verify-recaptcha/route.ts`)
- Проверяет токен reCAPTCHA через Google API
- Возвращает результат проверки (success, score, isHuman)
- В режиме разработки пропускает проверку, если ключи не настроены

### 3. Интеграция в формы
- **AuthModal** (`components/header.tsx`) - модальное окно регистрации
- **RegisterPage** (`app/register/page.tsx`) - страница регистрации

## Настройка

### 1. Получение ключей reCAPTCHA

1. Перейдите на [Google reCAPTCHA Admin Console](https://www.google.com/recaptcha/admin)
2. Нажмите "+" для создания нового сайта
3. Выберите reCAPTCHA v2 "I'm not a robot" Checkbox
4. Добавьте домены:
   - `localhost` (для разработки)
   - Ваш продакшн домен
5. Получите **Site Key** и **Secret Key**

### 2. Настройка переменных окружения

Отредактируйте файл `.env.local`:

```env
# reCAPTCHA Configuration
NEXT_PUBLIC_RECAPTCHA_SITE_KEY=your_site_key_here
RECAPTCHA_SECRET_KEY=your_secret_key_here
```

Замените `your_site_key_here` и `your_secret_key_here` на реальные ключи.

### 3. Перезапуск сервера

```bash
npm run dev
```

## Как это работает

### Процесс регистрации с капчей:

1. Пользователь заполняет форму регистрации
2. Отмечает капчу "Я не робот"
3. При отправке формы:
   - Проверяется валидность всех полей
   - Проверяется наличие токена reCAPTCHA
   - Токен отправляется на `/api/verify-recaptcha`
   - API проверяет токен через Google
   - Если проверка пройдена, выполняется регистрация
   - Если нет - показывается ошибка

### Безопасность

- **Site Key** используется на клиенте (публичный)
- **Secret Key** используется только на сервере (приватный)
- Проверка происходит на сервере через Google API
- Score-based проверка для reCAPTCHA v3 (если используется)

## Тестирование

### В режиме разработки:
- Если ключи не настроены, показывается заглушка
- Проверка пропускается автоматически
- Можно тестировать функциональность без реальных ключей

### В продакшне:
- Обязательно настройте реальные ключи
- Добавьте домен в Google reCAPTCHA Admin Console
- Протестируйте на реальном домене

## Устранение неполадок

### Капча не загружается:
- Проверьте `NEXT_PUBLIC_RECAPTCHA_SITE_KEY` в `.env.local`
- Убедитесь, что домен добавлен в Google reCAPTCHA Admin Console
- Проверьте консоль браузера на ошибки

### Проверка не проходит:
- Проверьте `RECAPTCHA_SECRET_KEY` в `.env.local`
- Убедитесь, что API endpoint `/api/verify-recaptcha` работает
- Проверьте логи сервера

### Ошибки в консоли:
- Убедитесь, что пакет `react-google-recaptcha` установлен
- Проверьте, что все импорты корректны
- Перезапустите сервер разработки

## Дополнительные возможности

### reCAPTCHA v3
Для более незаметной защиты можно перейти на reCAPTCHA v3:

1. Измените тип в Google reCAPTCHA Admin Console
2. Обновите компонент для использования `useGoogleReCaptcha` hook
3. Настройте score-based логику в API endpoint

### Кастомизация
- Измените тему: `theme="dark"` или `theme="light"`
- Измените размер: `size="compact"` или `size="normal"`
- Добавьте обработку ошибок и retry логику 