<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç POST –∑–∞–ø—Ä–æ—Å–æ–≤</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        button:hover { background: #0056b3; }
        .result { margin-top: 20px; padding: 15px; border-radius: 4px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .test-section { border: 1px solid #ddd; padding: 20px; margin: 20px 0; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç POST –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API</h1>
    
    <!-- –¢–µ—Å—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ API -->
    <div class="test-section">
        <h2>1. –¢–µ—Å—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ API (/api/test-email)</h2>
        <button onclick="testSimpleAPI()">üìß –¢–µ—Å—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ API</button>
        <div id="simpleResult"></div>
    </div>
    
         <!-- –¢–µ—Å—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ API -->
     <div class="test-section">
         <h2>2. –¢–µ—Å—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ API (/api/admin/notify-quiz-completion)</h2>
         <button onclick="testMainAPI()">üìß –¢–µ—Å—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ API</button>
         <div id="mainResult"></div>
     </div>
     
     <!-- –¢–µ—Å—Ç Email -->
     <div class="test-section">
         <h2>3. –¢–µ—Å—Ç Email –æ—Ç–ø—Ä–∞–≤–∫–∏</h2>
         <button onclick="testNodemailer()">üìß –¢–µ—Å—Ç Nodemailer</button>
         <div id="emailResult"></div>
     </div>
    
    <script>
        async function testSimpleAPI() {
            const resultDiv = document.getElementById('simpleResult');
            resultDiv.innerHTML = '<div class="info">‚è≥ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ—Å—Ç–æ–π API...</div>';
            
            try {
                const testData = {
                    phone: "+7 (953) 123-45-67",
                    discount: 25,
                    businessType: "ip",
                    coupon: "TEST123-2500",
                    answers: [
                        {"questionId": 1, "answer": "ip"},
                        {"questionId": 2, "answer": "chaos"}
                    ]
                };
                
                const response = await fetch('/api/test-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ –ü—Ä–æ—Å—Ç–æ–π API —Ä–∞–±–æ—Ç–∞–µ—Ç!<br>
                            <strong>–û—Ç–≤–µ—Ç:</strong> ${JSON.stringify(result, null, 2)}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ—Å—Ç–æ–≥–æ API<br>
                            <strong>–°—Ç–∞—Ç—É—Å:</strong> ${response.status}<br>
                            <strong>–û—Ç–≤–µ—Ç:</strong> ${JSON.stringify(result, null, 2)}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞<br>
                        <strong>–î–µ—Ç–∞–ª–∏:</strong> ${error.message}
                    </div>
                `;
            }
        }
        
        async function testMainAPI() {
            const resultDiv = document.getElementById('mainResult');
            resultDiv.innerHTML = '<div class="info">‚è≥ –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π API...</div>';
            
            try {
                const testData = {
                    phone: "+7 (953) 123-45-67",
                    discount: 25,
                    businessType: "ip",
                    coupon: "TEST123-2500",
                    answers: [
                        {"questionId": 1, "answer": "ip"},
                        {"questionId": 2, "answer": "chaos"}
                    ]
                };
                
                const response = await fetch('/api/admin/notify-quiz-completion', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π API —Ä–∞–±–æ—Ç–∞–µ—Ç!<br>
                            <strong>–û—Ç–≤–µ—Ç:</strong> ${JSON.stringify(result, null, 2)}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            ‚ùå –û—à–∏–±–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ API<br>
                            <strong>–°—Ç–∞—Ç—É—Å:</strong> ${response.status}<br>
                            <strong>–û—Ç–≤–µ—Ç:</strong> ${JSON.stringify(result, null, 2)}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞<br>
                        <strong>–î–µ—Ç–∞–ª–∏:</strong> ${error.message}
                    </div>
                `;
            }
                 }
         
         async function testSupabase() {
             const resultDiv = document.getElementById('supabaseResult');
             resultDiv.innerHTML = '<div class="info">‚è≥ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase...</div>';
             
             try {
                 const response = await fetch('/api/test-supabase', {
                     method: 'GET'
                 });
                 
                 const result = await response.json();
                 
                 if (response.ok) {
                     resultDiv.innerHTML = `
                         <div class="success">
                             ‚úÖ Supabase –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!<br>
                             <strong>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:</strong> ${result.services.database ? '‚úÖ' : '‚ùå'}<br>
                             <strong>Email —Å–µ—Ä–≤–∏—Å:</strong> ${result.services.email ? '‚úÖ' : '‚ùå'}<br>
                             <strong>–û—Ç–≤–µ—Ç:</strong> ${JSON.stringify(result, null, 2)}
                         </div>
                     `;
                 } else {
                     resultDiv.innerHTML = `
                         <div class="error">
                             ‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase<br>
                             <strong>–°—Ç–∞—Ç—É—Å:</strong> ${response.status}<br>
                             <strong>–û—Ç–≤–µ—Ç:</strong> ${JSON.stringify(result, null, 2)}
                         </div>
                     `;
                 }
             } catch (error) {
                 resultDiv.innerHTML = `
                     <div class="error">
                         ‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞<br>
                         <strong>–î–µ—Ç–∞–ª–∏:</strong> ${error.message}
                     </div>
                 `;
             }
         }
         
         async function testSupabaseEmail() {
             const resultDiv = document.getElementById('supabaseResult');
             resultDiv.innerHTML = '<div class="info">‚è≥ –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É email —á–µ—Ä–µ–∑ Supabase...</div>';
             
             try {
                 const response = await fetch('/api/test-supabase', {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json',
                     },
                     body: JSON.stringify({
                         testEmail: 'admin@prostoburo.com'
                     })
                 });
                 
                 const result = await response.json();
                 
                 if (response.ok) {
                     resultDiv.innerHTML = `
                         <div class="success">
                             ‚úÖ Supabase email —Ä–∞–±–æ—Ç–∞–µ—Ç!<br>
                             <strong>–û—Ç–≤–µ—Ç:</strong> ${JSON.stringify(result, null, 2)}
                         </div>
                     `;
                 } else {
                     resultDiv.innerHTML = `
                         <div class="error">
                             ‚ùå –û—à–∏–±–∫–∞ Supabase email<br>
                             <strong>–°—Ç–∞—Ç—É—Å:</strong> ${response.status}<br>
                             <strong>–û—Ç–≤–µ—Ç:</strong> ${JSON.stringify(result, null, 2)}
                         </div>
                     `;
                 }
             } catch (error) {
                 resultDiv.innerHTML = `
                     <div class="error">
                         ‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞<br>
                         <strong>–î–µ—Ç–∞–ª–∏:</strong> ${error.message}
                     </div>
                 `;
             }
         }
         
         async function testEdgeFunction() {
             const resultDiv = document.getElementById('supabaseResult');
             resultDiv.innerHTML = '<div class="info">‚è≥ –¢–µ—Å—Ç–∏—Ä—É–µ–º Edge Function...</div>';
             
             try {
                 // –ü–æ–ª—É—á–∞–µ–º URL Supabase –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (—á–µ—Ä–µ–∑ –Ω–∞—à API)
                 const configResponse = await fetch('/api/test-supabase');
                 const config = await configResponse.json();
                 
                 if (!config.success) {
                     throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Supabase');
                 }
                 
                 // –§–æ—Ä–º–∏—Ä—É–µ–º URL Edge Function
                 const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || 'https://qbjcdftphxre.supabase.co';
                 const edgeFunctionUrl = `${supabaseUrl}/functions/v1/send-email`;
                 
                 resultDiv.innerHTML = `
                     <div class="info">
                         üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º Edge Function:<br>
                         <strong>URL:</strong> ${edgeFunctionUrl}<br>
                         <strong>–°—Ç–∞—Ç—É—Å:</strong> –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å...
                     </div>
                 `;
                 
                 // –¢–µ—Å—Ç–∏—Ä—É–µ–º Edge Function
                 const response = await fetch(edgeFunctionUrl, {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json',
                     },
                     body: JSON.stringify({
                         to: 'admin@prostoburo.com',
                         subject: 'üß™ –¢–µ—Å—Ç Edge Function',
                         html: '<h1>–¢–µ—Å—Ç Edge Function</h1><p>–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç Supabase Edge Function.</p>',
                         text: '–¢–µ—Å—Ç Edge Function\n\n–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç Supabase Edge Function.'
                     })
                 });
                 
                 const result = await response.json();
                 
                 if (response.ok) {
                     resultDiv.innerHTML = `
                         <div class="success">
                             ‚úÖ Edge Function —Ä–∞–±–æ—Ç–∞–µ—Ç!<br>
                             <strong>–û—Ç–≤–µ—Ç:</strong> ${JSON.stringify(result, null, 2)}
                         </div>
                     `;
                 } else {
                     resultDiv.innerHTML = `
                         <div class="error">
                             ‚ùå –û—à–∏–±–∫–∞ Edge Function<br>
                             <strong>–°—Ç–∞—Ç—É—Å:</strong> ${response.status}<br>
                             <strong>–û—Ç–≤–µ—Ç:</strong> ${JSON.stringify(result, null, 2)}<br>
                             <strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> –í–æ–∑–º–æ–∂–Ω–æ, Edge Function –Ω–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç. –°–º. SUPABASE_SETUP.md
                         </div>
                     `;
                 }
             } catch (error) {
                 resultDiv.innerHTML = `
                     <div class="error">
                         ‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞<br>
                         <strong>–î–µ—Ç–∞–ª–∏:</strong> ${error.message}<br>
                         <strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> Edge Function –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç. –°–º. SUPABASE_SETUP.md
                     </div>
                 `;
             }
         }
     </script>
</body>
</html>
